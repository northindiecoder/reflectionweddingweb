!function(_){"use strict";function t(){this._activeZoom=this._initialScrollPosition=this._initialTouchPosition=this._touchMoveListener=null,this._$document=_(document),this._$window=_(window),this._$body=_(document.body),this._boundClick=_.proxy(this._clickHandler,this)}function n(t,o,e,i){this._fullHeight=this._fullWidth=this._overlay=this._targetImageWrap=null,this._targetImage=t,this._targetWidth=o,this._targetHeight=e,this._targetOffset=i,this._$body=_(document.body)}t.prototype.listen=function(){this._$body.on("click",'[data-action="zoom"]',_.proxy(this._zoom,this))},t.prototype._zoom=function(t){this._$body.addClass("hold-on"),setTimeout(function(){});var o=t.target,e=o.width,i=o.height,s=_(o).offset();if(o&&"IMG"==o.tagName)if(this._$body.hasClass("zoom-overlay-open")||this._$body.hasClass("zoom-overlay-transitioning"))this._$body.removeClass("hold-on");else{if(t.metaKey||t.ctrlKey)return window.open(t.target.getAttribute("data-original")||t.target.src,"_blank");if(e>=_(window).width()-n.OFFSET)this._$body.removeClass("hold-on");else{this._activeZoomClose(!0),this._activeZoom=new n(o,e,i,s),this._activeZoom.zoomImage(),this._$window.on("scroll",_.proxy(this._scrollHandler,this)),this._$window.on("resize",_.proxy(this._scrollHandler,this)),this._$document.on("keyup",_.proxy(this._keyHandler,this)),this._$document.on("touchstart.zoom",_.proxy(this._touchStart,this)),this._$body.on("click",".zoom-overlay",_.proxy(this._scrollHandler,this)),_(".gallery-slider").on("mousewheel",_.proxy(this._scrollHandler,this));var a=_(o).data("index");if(window.Theme.Gallery.setGalleryProgress(a),document.addEventListener?document.addEventListener("click",this._boundClick,!0):document.attachEvent("onclick",this._boundClick,!0),"bubbles"in t?t.bubbles&&t.stopPropagation():t.cancelBubble=!0,window._4ORMAT_DATA.theme.gallery_autoplay){var r=this;setTimeout(function(){_(o).hide(),setTimeout(function(){r._activeZoomClose(),setTimeout(function(){_(o).show()},500)},500)},5e3)}_(".gallery-slider").removeClass("gallery-slider-scrollable"),setTimeout(function(){_(".gallery-slider").addClass("gallery-slider-scrollable")},1e3),_("body").addClass("internal-hash"),history.replaceState?history.replaceState(null,null,"#"+a):location.hash="#"+a;r=this;this._$window.on("keydown",function(t){37!=t.keyCode&&39!=t.keyCode||(t.preventDefault(),_(o).hide(),_(".is-zooming").removeClass("is-zooming"),setTimeout(function(){r._activeZoomClose(),setTimeout(function(){_(o).show()},500)},500))})}}},t.prototype._activeZoomClose=function(t){this._activeZoom&&this._$body.hasClass("zoom-overlay-open")&&(t?this._activeZoom.dispose():this._activeZoom.close(),this._$window.off(".zoom"),this._$document.off(".zoom"),_(".is-zooming").removeClass("is-zooming"),document.removeEventListener("click",this._boundClick,!0),location.hash="",this._activeZoom=null)},t.prototype._scrollHandler=function(){this._activeZoomClose()},t.prototype._keyHandler=function(t){27==t.keyCode&&this._activeZoomClose()},t.prototype._clickHandler=function(t){t.preventDefault?t.preventDefault():event.returnValue=!1,"bubbles"in t?t.bubbles&&t.stopPropagation():t.cancelBubble=!0,"A"!==t.target.tagName?("IMG"===t.target.tagName&&window._4ORMAT_DATA.theme.gallery_zoom&&window.Theme.Gallery.showZoomedImage(t),this._activeZoomClose()):"_blank"===t.target.target?window.open(t.target.href,"_blank"):window.location.href=t.target.href},t.prototype._touchStart=function(t){this._initialTouchPosition=t.touches[0].pageY,_(t.target).on("touchmove.zoom",_.proxy(this._touchMove,this))},t.prototype._touchMove=function(t){10<Math.abs(t.touches[0].pageY-this._initialTouchPosition)&&(this._activeZoomClose(),_(t.target).off("touchmove.zoom"))},n.OFFSET=200,n._MAX_WIDTH=2560,n._MAX_HEIGHT=4096,n.prototype.zoomImage=function(){var t=document.createElement("img");t.onload=_.proxy(function(){this._fullHeight=Number(t.height),this._fullWidth=Number(t.width),this._zoomOriginal()},this),t.src=this._targetImage.src},n.prototype._zoomOriginal=function(){this._targetImageWrap=document.createElement("div"),this._targetImageWrap.className="zoom-img-wrap",setTimeout(function(){this._targetImage.parentNode.insertBefore(this._targetImageWrap,this._targetImage),this._targetImageWrap.appendChild(this._targetImage),_(this._targetImage.parentNode).parents(".asset").addClass("is-zooming"),_(this._targetImage).addClass("zoom-img").attr("data-action","zoom-out").attr("sizes","1000px"),this._overlay=document.createElement("div"),this._overlay.className="zoom-overlay",document.body.appendChild(this._overlay),this._calculateZoom(),this._triggerAnimation(),this._$body.removeClass("hold-on")}.bind(this),100)},n.prototype._calculateZoom=function(){this._targetImage.offsetWidth;var t=this._fullWidth,o=this._fullHeight,e=(_(window).scrollTop(),t/this._targetWidth),i=_(window).height()-n.OFFSET,s=_(window).width()-n.OFFSET,a=t/o,r=s/i;this._imgScaleFactor=t<s&&o<i?e:a<r?i/o*e:s/t*e},n.prototype._triggerAnimation=function(){this._targetImage.offsetWidth;var t=this._targetOffset,o=_(window).scrollTop()+_(window).height()/2,e=_(window).width()/2,i=t.top+this._targetHeight/2,s=t.left+this._targetWidth/2;this._translateY=o-i,this._translateX=e-s,this._$body.addClass("zoom-overlay-open");var a=this._targetHeight*this._imgScaleFactor,r=.7*_(window).width(),n=.15*_(window).width(),h=_(".is-zooming .caption").height(),l=(_(window).height()-a)/2,m="scale("+this._imgScaleFactor+")";if(_(".is-zooming .caption").width(r),h<100)var d="translate("+this._translateX+"px, "+this._translateY+"px)",c=l+a;else d="translate("+this._translateX+"px, "+(this._translateY-50)+"px)",c=l+a-50;_.support.transition&&(d+=" translateZ(0)"),_(this._targetImage).css({"-webkit-transform":m,"-ms-transform":m,transform:m}),_(this._targetImageWrap).css({"-webkit-transform":d,"-ms-transform":d,transform:d}),_(".is-zooming .caption").css({top:c,left:n})},n.prototype.close=function(){if(this._$body.removeClass("zoom-overlay-open").addClass("zoom-overlay-transitioning"),_(this._targetImage).css({"-webkit-transform":"","-ms-transform":"",transform:""}),_(this._targetImageWrap).css({"-webkit-transform":"","-ms-transform":"",transform:""}),!_.support.transition)return this.dispose();_(this._targetImage).one(_.support.transition.end,_.proxy(this.dispose,this)).emulateTransitionEnd(300)},n.prototype.dispose=function(){setTimeout(function(){this._targetImageWrap&&this._targetImageWrap.parentNode&&(_(this._targetImage).removeClass("zoom-img").attr("data-action","zoom"),this._targetImageWrap.parentNode.replaceChild(this._targetImage,this._targetImageWrap),this._overlay.parentNode.removeChild(this._overlay),this._$body.removeClass("zoom-overlay-transitioning"))}.bind(this),300)},_(function(){(new t).listen()})}(jQuery);